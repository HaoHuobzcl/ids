<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="asserts/css/bootstrap.min.css" th:href="@{/webjars/bootstrap/4.0.0/css/bootstrap.css}" rel="stylesheet">
    <script type="text/javascript" th:src="@{/webjars/jquery/3.3.1-1/jquery.js}"></script>
    <script th:src="@{/webjars/bootstrap/4.0.0/js/bootstrap.js}"></script>
    <script src="jquery-ajax-blob-arraybuffer.js"></script>
    <style>
        .footer{background:#fff ;position:absolute;bottom:0;width:100%;height:150px;background-color: dimgrey;}
    </style>
</head>
<body>
<div>
    <!-- 黑底白字 -->
    <div th:replace="commons/bar::topbar(activeUri='ids')"></div>

    <div class="container">
        <div class="row">

            <main role="main" class="col-lg-10 pt-5">
                    <div class="form-group">
                        <label class="card bg-info col-3">预测输入</label>
                        <input id="input" name="input" type="text" class="form-control col-12" placeholder="预测输入" th:value="${announcement!=null}?${announcement.title}">
                    </div>
                    <div class="form-group">
                        <label class="card bg-info col-3">预测结果</label>
                        <input id="result" name="result" type="text" class="form-control" placeholder="预测输入" th:value="${announcement!=null}?${announcement.title}">
                    </div>
                    <div class="form-group">
                        <label class="card bg-info col-3">系统参数</label>
                        <div class="col-sm-6">
                            <label class="col-sm-3">k值</label>

                        </div>
                        <label class="col-sm-3">准确度</label>
                        <div>
                            <label class="col-sm-3">训练集</label>
                            <!--<select class="form-control" style="width: 200px" name="userType">-->
                                <!--<option th:selected="${user!=null}?${user.userType == 0}" value="0">普通用户</option>-->
                                <!--<option th:selected="${user!=null}?${user.userType == 1}" value="1">管理员</option>-->
                            <!--</select>-->
                        </div>
                        <label class="col-sm-3">推荐k值</label>
                        <form  id="upload-form" action="/upload" method="POST" enctype="multipart/form-data">
                            <input class="form-control-file" type="file" name="test"/>
                        </form>
                    </div>

                <button type="submit" class="btn btn-primary predict" >预测</button>
                <button type="submit" class="btn btn-primary reset" >重置系统</button>
                <button   class="btn btn-xs btn-danger deleteBtn mark" >标记上传文件</button>

            </main>
        </div>
    </div>
    <div class="footer"></div>
</div>
<script>
    $(".deleteBtn").click(function(){
        //删除当前公告
        $("#deleteAnnouncementForm").attr("action",$(this).attr("del_uri")).submit();
        return false;
    });
    $(".predict").click(function(){
        $.ajax({
            url: "/ids/predict",
            type : "post",
            cache:false,
            data : {
                _method : "put",
                input:$("#input").val()
            },
            success : function(data){
                $("#result").val(data);
            },
            dataType : "text",
            error : function(data){
                alert(data.data)
                alert("出错了！")
            }
        })
    });
    $(".reset").click(function () {
        $.ajax({
            url:"/ids/reset",
            type:"post",
            cache:false,
            success:function (data) {
                if(data=="true"){
                    alert("重置成功!");
                    //参数重置
                }else {
                    alert("服务器繁忙!");
                }
            },
            dataType:"text",
            error:function (data) {
                alert("出错了:"+data)
            }
        })
    })




    function download(fileName) {

        var a = document.createElement('a');

        var url = '/ids/download?fileName='+fileName;

        var filename = fileName;


        a.href=url;

        a.download = filename;

        a.click()

    }

    $(".mark").click(function () {
        var formData = new FormData(document.getElementById("upload-form"));
        $.ajax({
            url:"/ids/mark",
            type:"post",
            cache:false,
            data: formData,
            contentType: false,
            processData: false,
            dataType:"text",
            success:function (data) {
                if(data){
                    download(data);
                    alert("标记成功!");
                }else {
                    alert("服务器繁忙!");
                }
            },
            error:function (data) {
                alert("出错了:"+data)
            }
        })
    })
</script>
</body>
</html>